import pandas as pd

# 1. å»ºç«‹çœŸå¯¦ç¯„ä¾‹å°å¸³å–®
def create_realistic_statement(filename="sample_statement.xlsx"):
    data = {
        'æ—¥æœŸ': [
            '2025-06-01', '2025-06-01', '2025-06-02', '2025-06-02', '2025-06-03',
            '2025-06-03', '2025-06-04', '2025-06-04', '2025-06-04', '2025-06-05',
            '2025-06-05', '2025-06-06', '2025-06-06', '2025-06-07', '2025-06-07',
            '2025-06-07', '2025-06-08', '2025-06-08', '2025-06-09', '2025-06-10',
            '2025-06-10', '2025-06-11', '2025-06-11', '2025-06-12', '2025-06-12',
            '2025-06-13', '2025-06-13', '2025-06-14', '2025-06-14', '2025-06-15',
            '2025-06-15', '2025-06-16', '2025-06-17', '2025-06-17', '2025-06-18'
        ],
        'é …ç›®': [
            '7-11è³¼ç‰©', 'è–ªè³‡å…¥å¸³', 'æ—©é¤åº— è±†æ¼¿', 'æ·é‹æ‚ éŠå¡åŠ å€¼', 'ATMææ¬¾',
            'è½‰å¸³çµ¦å¥½å‹', 'å®¶æ¨‚ç¦ è³¼ç‰©', 'Netflixæœˆè²»', 'å…¨è¯ æ¶ˆè²»', 'Uber Eats è¨‚é¤',
            'LINE Pay è½‰å¸³', 'æ‰‹çºŒè²»', 'åšå®¢ä¾† æ›¸ç±', 'æ‹è³£é€€æ¬¾', 'åœ‹æ³°ä¸–è¯ä¿¡ç”¨å¡é‚„æ¬¾',
            'è½‰å¸³ä¾†è‡ªç‹å°æ˜', 'Subway åˆé¤', 'ç§Ÿé‡‘æ”¶å…¥', 'æ°´æœæ”¤', 'å®¶æ¨‚ç¦ ç”Ÿé®®',
            'åŠ æ²¹ç«™', 'iTunes è¨‚é–±', 'å…¬å¸ç™¼ç¥¨çé‡‘', 'é†«é™¢æ›è™Ÿè²»', 'è—¥å±€æ¶ˆè²»',
            'PChome è³¼ç‰©', 'é‚„ä¿¡ç”¨å¡', 'æ°´è²»', 'é›»è²»', 'é›»è©±è²»',
            'é›»è©±è²»ï¼ˆè£œæ‰£ï¼‰', 'å’–å•¡åº— Starbucks', 'Uber æ­è»Š', 'é›»å½±é™¢ è¨‚ç¥¨', 'ææ¬¾'
        ],
        'é‡‘é¡': [
            -165, 38000, -45, -500, -1000,
            -600, -820, -390, -256, -180,
            -900, -15, -315, 200, -9000,
            1500, -139, 8000, -60, -430,
            -1300, -150, 3000, -200, -185,
            -1299, -5000, -320, -870, -600,
            -210, -145, -250, -280, -2000
        ],
        'å‚™è¨»': [
            'ç”Ÿæ´»æ—¥å¸¸', '2025å¹´6æœˆè–ªæ°´', 'æ—©é¤', 'æ·é‹é€šå‹¤åŠ å€¼', 'ç¾é‡‘æé ˜',
            'LINEå¥½å‹è½‰å¸³', 'æ—¥ç”¨å“æ¡è³¼', 'æ¯æœˆè‡ªå‹•æ‰£æ¬¾', 'æ—¥å¸¸æ¡è²·', 'å¤–é€å¹³å°',
            'æ‰‹æ©Ÿè½‰å¸³', 'è½‰å¸³æ‰‹çºŒè²»', 'é–±è®€è³¼ç‰©', 'é€€è²¨', 'ä¿¡ç”¨å¡å¸³å–®ä»˜æ¬¾',
            'è½‰å¸³æ”¶æ¬¾', 'é€Ÿé£Ÿåº—ç”¨é¤', 'æˆ¿æ±è½‰å…¥', 'å¸‚å ´æ°´æœ', 'æ¡è²·è”¬èœè‚‰é¡',
            'æ±½æ²¹åŠ æ²¹', 'è˜‹æœè¨‚é–±è²»ç”¨', 'å“¡å·¥çé‡‘', 'é–€è¨ºè²»ç”¨', 'æ„Ÿå†’è—¥',
            'ç·šä¸Šè³¼ç‰©', 'ç¹³è²»', 'å°æ°´ç¹³è²»å–®', 'å°é›»å¸³å–®', 'ä¸­è¯é›»ä¿¡',
            'è£œæ‰£ä¸ŠæœŸè²»ç”¨', 'å’–å•¡é£²å“', 'äº¤é€šæ­ä¹˜', 'æœ‹å‹ç´„é›»å½±', 'ATM ç¾é‡‘'
        ]
    }
    df = pd.DataFrame(data)
    df.to_excel(filename, index=False)
    print(f"âœ… å·²å»ºç«‹ç¯„ä¾‹å°å¸³å–®ï¼š{filename}")

# 2. è‡ªå‹•åˆ†é¡
def auto_categorize(df: pd.DataFrame) -> pd.DataFrame:
    def categorize(row):
        item = row['é …ç›®']
        if any(kw in item for kw in ['æ—©é¤', 'åˆé¤', 'é¤', 'Starbucks', 'Subway']):
            return 'é¤é£²'
        elif any(kw in item for kw in ['7-11', 'å…¨è¯', 'å®¶æ¨‚ç¦', 'PChome', 'åšå®¢ä¾†']):
            return 'è³¼ç‰©'
        elif any(kw in item for kw in ['è–ªè³‡', 'æ”¶å…¥', 'çé‡‘', 'é€€æ¬¾']):
            return 'æ”¶å…¥'
        elif any(kw in item for kw in ['ATM', 'è½‰å¸³', 'é‚„æ¬¾', 'ææ¬¾']):
            return 'éŠ€è¡Œäº¤æ˜“'
        elif any(kw in item for kw in ['æ‚ éŠå¡', 'Uber', 'æ·é‹', 'åŠ æ²¹']):
            return 'äº¤é€š'
        elif any(kw in item for kw in ['æ°´è²»', 'é›»è²»', 'é›»è©±è²»']):
            return 'ç”Ÿæ´»è²»'
        elif any(kw in item for kw in ['Netflix', 'iTunes', 'é›»å½±']):
            return 'å¨›æ¨‚è¨‚é–±'
        elif any(kw in item for kw in ['è—¥å±€', 'é†«é™¢']):
            return 'é†«ç™‚'
        else:
            return 'å…¶ä»–'
    df['åˆ†é¡'] = df.apply(categorize, axis=1)
    return df

# 3. æ‰‹å‹•æ ¡å°
def manual_check(df: pd.DataFrame) -> pd.DataFrame:
    print("\nğŸ–‹ï¸ é€²å…¥æ‰‹å‹•æ ¡å°æ¨¡å¼ï¼ˆæŒ‰ Enter å¯è·³éï¼‰\n")
    for i, row in df.iterrows():
        print(f"{i+1:02d}. {row['æ—¥æœŸ']} | {row['é …ç›®']} | é‡‘é¡: {row['é‡‘é¡']} | å»ºè­°åˆ†é¡: {row['åˆ†é¡']}")
        new_cat = input("è«‹è¼¸å…¥æ–°çš„åˆ†é¡ï¼ˆæˆ– Enter ä¿ç•™ï¼‰ï¼š").strip()
        if new_cat:
            df.at[i, 'åˆ†é¡'] = new_cat
    return df

# 4. åŒ¯å‡ºçµæœ
def export_to_excel(df: pd.DataFrame, output_path: str):
    df.to_excel(output_path, index=False)
    print(f"\nğŸ“¤ å·²åŒ¯å‡ºåˆ†é¡å¾Œå°å¸³å–®è‡³ï¼š{output_path}")

# ä¸»æµç¨‹
def main():
    input_file = "sample_statement.xlsx"
    output_file = "categorized_statement.xlsx"
    
    create_realistic_statement(input_file)
    df = pd.read_excel(input_file)
    df = auto_categorize(df)
    df = manual_check(df)
    export_to_excel(df, output_file)

if __name__ == "__main__":
    main()
